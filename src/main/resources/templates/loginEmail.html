<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ë©”ì¼ë¡œ ë¡œê·¸ì¸/íšŒì›ê°€ì…</title>
    <link rel="stylesheet" th:href="@{/css/loginEmail.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <script>
        function togglePasswordVisibility() {
            const passwordField = document.getElementById("password");
            passwordField.type = passwordField.type === "password" ? "text" : "password";
        }
    </script>
</head>
<body>
<header>
    <!-- Header ë‚´ìš© -->
    <nav>
        <ul>
            <li><a href="#">BEST</a></li>
            <li><a href="#">WOMEN</a></li>
            <li><a href="#">MEN</a></li>
            <!-- ë” ë§ì€ ë©”ë‰´ -->
        </ul>
    </nav>
</header>
<main>
    <div class="login-container">
        <div class="login-form">
            <h1 class="login-title">ì´ë©”ì¼ë¡œ<br>ë¡œê·¸ì¸/íšŒì›ê°€ì… í•˜ê¸°</h1>
            <form th:action="@{'/api/login/member'}" method="post" onsubmit="sendLoginRequest(event)">
                <div class="form-group">
                    <label for="loginId" class="input-label">ì´ë©”ì¼(ì•„ì´ë””)</label>
                    <input
                            id="loginId"
                            class="input-field"
                            placeholder="abc@email.com"
                            autocapitalize="none"
                            autocomplete="loginId"
                            type="text"
                            name="loginId">
                    <span id="loginIdError" class="error-message"></span>
                </div>
                <div class="form-group">
                    <label for="password" class="input-label">ë¹„ë°€ë²ˆí˜¸</label>
                    <div class="password-input-wrapper">
                        <input
                                id="password"
                                class="input-field"
                                placeholder="8ì ì´ìƒì˜ ë¹„ë°€ë²ˆí˜¸"
                                autocapitalize="none"
                                autocomplete="current-password"
                                type="password"
                                name="password">
                        <button type="button" class="password-toggle-button" onclick="togglePasswordVisibility()">ğŸ‘ï¸</button>
                    </div>
                    <div id="passwordError" class="error-message"></div>
                    <div id="loginError" class="error-message"></div>
                </div>
                <div class="form-actions">
                    <button class="submit-button" type="submit">ë¡œê·¸ì¸</button>
                    <a class="register-button" th:href="@{'/member/join'}">ì´ë©”ì¼ë¡œ ê°€ì…í•˜ê¸°</a>
                </div>
                <div class="links">
                    <a href="/account/find">ê³„ì • ì°¾ê¸°</a>
                    <span>|</span>
                    <a href="/password/reset">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</a>
                    <span>|</span>
                    <a href="/contact">ë¬¸ì˜í•˜ê¸°</a>
                </div>
            </form>
        </div>
    </div>
</main>
<footer th:replace="/common/footer :: footer-container"></footer>

</body>
<script>
    async function sendLoginRequest(event) {
        // ê¸°ë³¸ í¼ ë™ì‘ ì¤‘ì§€
        event.preventDefault();

        // í¼ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        var loginId = document.getElementById('loginId').value;
        var password = document.getElementById('password').value;

        // JSON ë°ì´í„° ìƒì„±
        var requestData = {
            loginId: loginId,
            password: password
        };

        try {
            // Fetch APIë¡œ POST ìš”ì²­ ë³´ë‚´ê¸°
            var response = await fetch('/api/login/member', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
            });

            // ì„œë²„ ì‘ë‹µ ì²˜ë¦¬
            if (response.ok) {
                // ì„±ê³µ ì‹œ í˜ì´ì§€ ì´ë™
                window.location.href = "/"; // ì„±ê³µ ì‹œ ë£¨íŠ¸ ê²½ë¡œë¡œ ì´ë™
            } else {
                var errorData = await response.json();
                handleErrors(errorData);
            }
        } catch (error) {
            alert('ì„œë²„ì™€ì˜ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    }

    function handleErrors(errorData) {
        // ê¸°ì¡´ ì—ëŸ¬ ë©”ì‹œì§€ ì´ˆê¸°í™”
        document.querySelectorAll('.error-message').forEach(function (element) {
            element.textContent = '';
        });

        // ì—ëŸ¬ ë°ì´í„°ê°€ í•„ë“œ ì—ëŸ¬ì¼ ê²½ìš° ì²˜ë¦¬
        if (errorData && errorData.fieldErrors) {
            errorData.fieldErrors.forEach(function (error) {
                const field = error.field;
                const reason = error.reason;

                // í•´ë‹¹ í•„ë“œì˜ ì—ëŸ¬ ë©”ì‹œì§€ ìš”ì†Œ ì°¾ê¸°
                const errorElement = document.getElementById(field + 'Error');
                if (errorElement) {
                    errorElement.textContent = reason; // ì—ëŸ¬ ë©”ì‹œì§€ ì„¤ì •
                    errorElement.style.display = 'block'; // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
                }
            });
        } else if (errorData && errorData.message) {
            // ì¼ë°˜ ì—ëŸ¬ ë©”ì‹œì§€ ì²˜ë¦¬
            const loginError = document.getElementById('loginError');
            loginError.textContent = errorData.message;
            loginError.style.display = 'block';
        } else {
            // ê¸°ë³¸ ì˜¤ë¥˜ ë©”ì‹œì§€ ì²˜ë¦¬
            const loginError = document.getElementById('loginError');
            loginError.textContent = 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
            loginError.style.display = 'block';
        }
    }
</script>
</html>