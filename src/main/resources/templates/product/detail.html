<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANKIM</title>
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <link rel="stylesheet" th:href="@{/css/product/detail.css}">
</head>
<body>
<!-- í—¤ë” í¬í•¨ -->
<div th:replace="fragments/header :: header"></div>

<!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
<nav class="breadcrumb">
    <!-- ì¤‘ë¶„ë¥˜ -->
    <div class="breadcrumb-dropdown" data-dropdown id="middle-category">
        <span id="middle-category-name">
            <a th:href="@{/product/list(condition=${middleCategoryName.name})}"
               th:text="${middleCategoryName?.name ?: 'ì¹´í…Œê³ ë¦¬ ì—†ìŒ'}">
            </a>
        </span>
        <div class="icon-wrapper">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
                <path d="M19.7 34.5c16.3-6.8 35 .9 41.8 17.2L192 364.8 322.5 51.7c6.8-16.3 25.5-24 41.8-17.2s24 25.5 17.2 41.8l-160 384c-5 11.9-16.6 19.7-29.5 19.7s-24.6-7.8-29.5-19.7L2.5 76.3c-6.8-16.3 .9-35 17.2-41.8z"/>
            </svg>
        </div>
        <ul class="breadcrumb-dropdown-menu" id="middle-category-menu"></ul>
    </div>

    <!-- ì†Œë¶„ë¥˜ -->
    <div class="breadcrumb-dropdown" data-dropdown id="sub-category">
        <span id="sub-category-name">
            <a th:href="@{/product/list(condition=${middleCategoryName.name}, category=${product.categoryResponse.categoryNo})}"
               th:text="${childCategoryName}">
            </a>
        </span>
        <div class="icon-wrapper">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
                <path d="M19.7 34.5c16.3-6.8 35 .9 41.8 17.2L192 364.8 322.5 51.7c6.8-16.3 25.5-24 41.8-17.2s24 25.5 17.2 41.8l-160 384c-5 11.9-16.6 19.7-29.5 19.7s-24.6-7.8-29.5-19.7L2.5 76.3c-6.8-16.3 .9-35 17.2-41.8z"/>
            </svg>
        </div>
        <ul class="breadcrumb-dropdown-menu" id="sub-category-menu"></ul>
    </div>
</nav>
<!-- âœ… ì¤‘ë¶„ë¥˜ IDì™€ ì†Œë¶„ë¥˜ IDë¥¼ JavaScriptì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì „ë‹¬ -->
<script>
    window.middleCategoryId = "[[${middleCategoryName.categoryNo}]]";
    window.childCategoryId = "[[${product.categoryResponse.categoryNo}]]";
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        fetch('/header')
            .then(response => response.json())
            .then(data => {
                const { middleCategories, subCategories } = data;

                const middleCategoryMenu = document.getElementById("middle-category-menu");
                const subCategoryMenu = document.getElementById("sub-category-menu");

                middleCategoryMenu.innerHTML = "";
                subCategoryMenu.innerHTML = "";

                // âœ… ê³ ì • ì¤‘ë¶„ë¥˜ ì¶”ê°€ (BEST, NEW, MADE)
                const fixedCategories = [
                    { name: "BEST", url: "/product/list?condition=BEST" },
                    { name: "NEW", url: "/product/list?condition=NEW" },
                    { name: "MADE", url: "/product/list?condition=HANDMADE" }
                ];

                fixedCategories.forEach(category => {
                    const listItem = document.createElement("li");
                    listItem.innerHTML = `<a href="${category.url}">${category.name}</a>`;
                    listItem.addEventListener("click", () => {
                        window.location.href = category.url;
                    });
                    middleCategoryMenu.appendChild(listItem);
                });

                // âœ… ë™ì  ì¤‘ë¶„ë¥˜ ì¶”ê°€ (ëª¨ë“  ì¤‘ë¶„ë¥˜ í‘œì‹œ)
                middleCategories.forEach(category => {
                    const categoryCondition = category.name === "OPS/SK" ? "OPS" : category.name;
                    const categoryUrl = `/product/list?condition=${categoryCondition}`;
                    const listItem = document.createElement("li");
                    listItem.innerHTML = `<a href="${categoryUrl}">${category.name}</a>`;
                    listItem.addEventListener("click", () => {
                        window.location.href = categoryUrl;
                    });
                    middleCategoryMenu.appendChild(listItem);
                });

                // âœ… ì´ˆê¸° ë Œë”ë§ ì‹œ, í˜„ì¬ ìƒí’ˆì˜ ì¤‘ë¶„ë¥˜ì— í•´ë‹¹í•˜ëŠ” ì†Œë¶„ë¥˜ë§Œ í‘œì‹œ
                const productMiddleCategoryNo = parseInt(window.middleCategoryId); // âœ… Thymeleafì—ì„œ ì „ë‹¬ë°›ì€ ê°’ ì‚¬ìš©

                if (!isNaN(productMiddleCategoryNo)) {
                    const filteredSubCategories = subCategories.filter(sub => sub.parentNo === productMiddleCategoryNo);
                    filteredSubCategories.forEach(subCategory => {
                        const parentCategory = middleCategories.find(cat => cat.categoryNo === subCategory.parentNo);
                        if (parentCategory) {
                            const parentCategoryCondition = parentCategory.name === "OPS/SK" ? "OPS" : parentCategory.name;
                            const subCategoryUrl = `/product/list?condition=${parentCategoryCondition}&category=${subCategory.categoryNo}`;
                            const subItem = document.createElement("li");
                            subItem.innerHTML = `<a href="${subCategoryUrl}">${subCategory.name}</a>`;
                            subItem.addEventListener("click", () => {
                                window.location.href = subCategoryUrl;
                            });
                            subCategoryMenu.appendChild(subItem);
                        }
                    });
                }
            })
            .catch(error => console.error("Error loading categories:", error));

        // âœ… ë“œë¡­ë‹¤ìš´ ìœ ì§€ ê¸°ëŠ¥
        document.querySelectorAll("[data-dropdown]").forEach(dropdown => {
            const menu = dropdown.querySelector(".breadcrumb-dropdown-menu");
            if (menu) {
                dropdown.addEventListener("mouseenter", () => menu.style.display = "block");
                dropdown.addEventListener("mouseleave", () => setTimeout(() => {
                    if (!menu.matches(":hover") && !dropdown.matches(":hover")) {
                        menu.style.display = "none";
                    }
                }, 200));
                menu.addEventListener("mouseenter", () => menu.style.display = "block");
                menu.addEventListener("mouseleave", () => setTimeout(() => {
                    if (!menu.matches(":hover") && !dropdown.matches(":hover")) {
                        menu.style.display = "none";
                    }
                }, 200));
            }
        });
    });
</script>

<!-- ìƒí’ˆ ìƒì„¸ í˜ì´ì§€ -->
<div class="product-detail-container">
    <!-- ìƒí’ˆ ì´ë¯¸ì§€ ì˜ì—­ -->
    <div class="product-image">
        <div class="slider-container">
            <button class="prev-btn">&lt;</button>
            <div class="image-wrapper">
                <!-- âœ… RepImgYnì´ 'Y'ì¸ ì´ë¯¸ì§€ë§Œ í‘œì‹œ -->
                <th:block th:each="img, iterStat : ${product.productImgs}">
                    <th:block th:if="${img.repImgYn == 'Y'}">
                        <img th:src="${img.imgUrl}" class="slider-img"
                             th:classappend="${iterStat.index == 0} ? 'active' : ''" alt="ëŒ€í‘œ ìƒí’ˆ ì´ë¯¸ì§€">
                    </th:block>
                </th:block>
            </div>
            <button class="next-btn">&gt;</button>
        </div>

        <!-- âœ… ì¸ë””ì¼€ì´í„° (ì )ë„ RepImgYnì´ 'Y'ì¸ ì´ë¯¸ì§€ ê°œìˆ˜ë§Œí¼ í‘œì‹œ -->
        <div class="indicator-container">
            <th:block th:each="img, iterStat : ${product.productImgs}">
                <th:block th:if="${img.repImgYn == 'Y'}">
                    <span class="indicator-dot" th:classappend="${iterStat.index == 0} ? 'active' : ''"></span>
                </th:block>
            </th:block>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const images = document.querySelectorAll(".slider-img");
            const indicators = document.querySelectorAll(".indicator-dot");
            const prevBtn = document.querySelector(".prev-btn");
            const nextBtn = document.querySelector(".next-btn");

            let currentIndex = 0;

            function showImage(index) {
                images.forEach(img => img.classList.remove("active"));
                indicators.forEach(dot => dot.classList.remove("active"));

                images[index].classList.add("active");
                indicators[index].classList.add("active");

                // ì²« ë²ˆì§¸ ì´ë¯¸ì§€ì—ì„œëŠ” '<' ë²„íŠ¼ ìˆ¨ê¹€
                if (index === 0) {
                    prevBtn.style.display = "none";
                } else {
                    prevBtn.style.display = "block";
                }

                // ë§ˆì§€ë§‰ ì´ë¯¸ì§€ì—ì„œëŠ” '>' ë²„íŠ¼ ë¹„í™œì„±í™”
                if (index === images.length - 1) {
                    nextBtn.classList.add("disabled");
                } else {
                    nextBtn.classList.remove("disabled");
                }
            }

            function nextImage() {
                if (currentIndex < images.length - 1) {
                    currentIndex++;
                    showImage(currentIndex);
                }
            }

            function prevImage() {
                if (currentIndex > 0) {
                    currentIndex--;
                    showImage(currentIndex);
                }
            }

            nextBtn.addEventListener("click", nextImage);
            prevBtn.addEventListener("click", prevImage);

            // ì´ˆê¸° ì´ë¯¸ì§€ ì„¤ì •
            showImage(currentIndex);
        });

    </script>

    <!-- ìƒí’ˆ ì •ë³´ ì˜ì—­ -->
    <div class="product-info-container">
        <!-- êµ¬ë³„ì„  -->
        <div class="section-divider"></div>

        <!-- ì œëª©ê³¼ í•˜íŠ¸ë¥¼ ê°ì‹¸ëŠ” ì»¨í…Œì´ë„ˆ -->
        <div class="title-container">
            <div class="title-box">
                <h1 class="product-title" th:text="${product.name}"></h1>
            </div>
            <!-- ì–‡ì€ íšŒìƒ‰ êµ¬ë³„ì„  -->
            <div class="divider"></div>
            <div class="wishlist-box">
                <svg class="wishlist-icon" id="wishlist" viewBox="0 0 24 24">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                </svg>
            </div>
        </div>

        <div class="product-info">
            <!-- ìƒí’ˆ ì½”ë“œ -->
            <p class="product-code">ìƒí’ˆ ì½”ë“œ: <span th:text="${product.code}"></span></p>

            <!-- í‰ì ê³¼ ë¦¬ë·° ê°œìˆ˜ -->
            <div class="product-rating-container">
                <!-- ë³„ì  í‘œì‹œ -->
                <div class="star-rating" data-rating="4.5"></div>
                <!-- ë¦¬ë·° ê°œìˆ˜ -->
                <a href="#" class="review-count">
                    <span th:text="${product.rvwCnt}"></span>ê°œ ë¦¬ë·° ë³´ê¸°
                </a>
            </div>

            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    const starRating = document.querySelector(".star-rating");
                    const rating = parseFloat(starRating.dataset.rating); // ì˜ˆ: 4.5

                    let stars = "";

                    const fullStar = `<svg class="star-icon" viewBox="0 0 576 512">
        <path d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"/>
    </svg>`;

                    const halfStar = `<svg class="star-icon" viewBox="0 0 576 512">
        <path d="M288 376.4l.1-.1 26.4 14.1 85.2 45.5-16.5-97.6-4.8-28.7 20.7-20.5 70.1-69.3-96.1-14.2-29.3-4.3-12.9-26.6L288.1 86.9l-.1 .3 0 289.2zm175.1 98.3c2 12-3 24.2-12.9 31.3s-23 8-33.8 2.3L288.1 439.8 159.8 508.3C149 514 135.9 513.1 126 506s-14.9-19.3-12.9-31.3L137.8 329 33.6 225.9c-8.6-8.5-11.7-21.2-7.9-32.7s13.7-19.9 25.7-21.7L195 150.3 259.4 18c5.4-11 16.5-18 28.8-18s23.4 7 28.8 18l64.3 132.3 143.6 21.2c12 1.8 22 10.2 25.7 21.7s.7 24.2-7.9 32.7L438.5 329l24.6 145.7z"/>
    </svg>`;

                    const emptyStar = `<svg class="star-icon" viewBox="0 0 576 512">
        <path d="M287.9 0c9.2 0 17.6 5.2 21.6 13.5l68.6 141.3 153.2 22.6c9 1.3 16.5 7.6 19.3 16.3s.5 18.1-5.9 24.5L433.6 328.4l26.2 155.6c1.5 9-2.2 18.1-9.7 23.5s-17.3 6-25.3 1.7l-137-73.2L151 509.1c-8.1 4.3-17.9 3.7-25.3-1.7s-11.2-14.5-9.7-23.5l26.2-155.6L31.1 218.2c-6.5-6.4-8.7-15.9-5.9-24.5s10.3-14.9 19.3-16.3l153.2-22.6L266.3 13.5C270.4 5.2 278.7 0 287.9 0zm0 79L235.4 187.2c-3.5 7.1-10.2 12.1-18.1 13.3L99 217.9 184.9 303c5.5 5.5 8.1 13.3 6.8 21L171.4 443.7l105.2-56.2c7.1-3.8 15.6-3.8 22.6 0l105.2 56.2L384.2 324.1c-1.3-7.7 1.2-15.5 6.8-21l85.9-85.1L358.6 200.5c-7.8-1.2-14.6-6.1-18.1-13.3L287.9 79z"/>
    </svg>`;

                    for (let i = 1; i <= 5; i++) {
                        if (rating >= i) {
                            stars += fullStar; // ê½‰ ì°¬ ë³„
                        } else if (rating >= i - 0.5) {
                            stars += halfStar; // ë°˜ ë³„
                        } else {
                            stars += emptyStar; // ë¹ˆ ë³„
                        }
                    }

                    starRating.innerHTML = stars;
                });
            </script>

            <div class="product-price">
                <!-- ì›ê°€ -->
                <div class="original-price-container">
                    <span class="original-price" th:text="${#numbers.formatInteger(product.origPrice, 3, 'COMMA')}"></span>
                    <span class="currency-unit">ì›</span>
                </div>

                <!-- í• ì¸ìœ¨ & íŒë§¤ê°€ -->
                <div class="discount-container">
                    <span class="discount-rate" th:text="${product.discRate} + '%'"></span>
                    <span class="sale-price">
                        <span class="price-value" th:text="${#numbers.formatInteger(product.sellPrice, 3, 'COMMA')}"></span>
                        <span class="currency-unit small">ì›</span>
                    </span>
                </div>
            </div>
            <!-- ì–‡ì€ íšŒìƒ‰ êµ¬ë³„ì„  -->
            <div class="thin-divider"></div>

            <div class="shipping-info">
                <!-- êµ¬ë§¤ ì ë¦½ê¸ˆ -->
                <div class="shipping-row">
                    <span class="shipping-label">êµ¬ë§¤ ì ë¦½ê¸ˆ</span>
                    <span class="shipping-value">ìµœëŒ€ 255 ë§ˆì¼ë¦¬ì§€ ì ë¦½ ì˜ˆì •</span>
                </div>

                <!-- ë¬´ì´ì í• ë¶€ -->
                <div class="shipping-row">
                    <span class="shipping-label">ë¬´ì´ì í• ë¶€</span>
                    <span class="shipping-value">
            <span class="gray-link">ì¹´ë“œì‚¬ë³„ í• ë¶€ í˜œíƒ ì•ˆë‚´</span>
        </span>
                </div>

                <!-- ë°°ì†¡ì •ë³´ -->
                <div class="shipping-row">
        <span class="shipping-label">
            ë°°ì†¡ì •ë³´
            <span class="tooltip-icon" title="ì¶œê³ ì¼ ê¸°ì¤€ ë°°ì†¡ ì†Œìš” ê¸°ê°„">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                    <path fill="#888" class="tooltip-svg"
                          d="M464 256A208 208 0 1 0 48 256a208 208 0 1 0 416 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm169.8-90.7c7.9-22.3 29.1-37.3 52.8-37.3l58.3 0c34.9 0 63.1 28.3 63.1 63.1c0 22.6-12.1 43.5-31.7 54.8L280 264.4c-.2 13-10.9 23.6-24 23.6c-13.3 0-24-10.7-24-24l0-13.5c0-8.6 4.6-16.5 12.1-20.8l44.3-25.4c4.7-2.7 7.6-7.7 7.6-13.1c0-8.4-6.8-15.1-15.1-15.1l-58.3 0c-3.4 0-6.4 2.1-7.5 5.3l-.4 1.2c-4.4 12.5-18.2 19-30.6 14.6s-19-18.2-14.6-30.6l.4-1.2zM224 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"/>
                </svg>
            </span>
        </span>
                    <span class="shipping-value blue-light">2ì¼ ì´ë‚´ ì¶œê³ </span>
                </div>

                <!-- ë°°ì†¡ë¹„ -->
                <div class="shipping-row">
                    <span class="shipping-label">ë°°ì†¡ë¹„</span>
                    <div class="shipping-value shipping-details">
                        <span th:if="${product.freeShip == 'Y'}" class="blue-light">ë¬´ë£Œë°°ì†¡</span>
                        <span th:if="${product.freeShip != 'Y'}" class="blue-light" th:text="${#numbers.formatInteger(product.shipFee, 3, 'COMMA')} + 'ì›'"></span>
                    </div>
                </div>
                <div class="shipping-note-container">
                    <p th:if="${product.freeShip != 'Y'}" class="shipping-note">50,000ì› ì´ìƒ êµ¬ë§¤ ì‹œ ë¬´ë£Œë°°ì†¡</p>
                    <p class="shipping-note">ì œì£¼/ë„ì„œì‚°ê°„ 3,000ì› ì¶”ê°€</p>
                </div>
            </div>

            <script th:inline="javascript">
                /*<![CDATA[*/
                const itemMap = /*[[${itemMap}]]*/ {};
                const optionItemMap = /*[[${optionItemMap}]]*/ {};
                const optionGroups = /*[[${optionGroups}]]*/ {};
                const productPrice = /*[[${product.sellPrice}]]*/ 0; // âœ… ê¸°ë³¸ ìƒí’ˆ ê°€ê²©
                const productNo = /*[[${product.no}]]*/ 0; // âœ… ìƒí’ˆ ë²ˆí˜¸
                console.log("ğŸŸ¢ itemMap ë°ì´í„°:", itemMap);
                console.log("ğŸŸ¢ optionItemMap ë°ì´í„°:", optionItemMap);
                console.log("ğŸŸ¢ optionGroups ë°ì´í„°:", optionGroups);
                /*]]>*/
            </script>

            <div class="product-options">
                <th:block th:each="group, iterStat : ${optionGroups}">
                    <div class="custom-dropdown" th:data-group-index="${iterStat.index}">
                        <!-- ì„ íƒëœ ì˜µì…˜ ê·¸ë£¹ëª… -->
                        <div class="dropdown-selected" th:data-group-name="${group.groupName}">
                            <span class="group-label">[[${group.groupName}]]</span>
                            <span class="dropdown-arrow">âˆ¨</span>
                        </div>

                        <!-- ì˜µì…˜ ëª©ë¡ -->
                        <ul class="dropdown-options" th:data-group-index="${iterStat.index}">
                            <th:block th:if="${itemMap != null and itemMap[group.groupName] != null}">
                                <th:block th:each="option : ${itemMap[group.groupName]}">
                                    <li class="dropdown-item"
                                        th:data-value="${option.optionValueNo}"
                                        th:data-group-index="${iterStat.index}">
                                        [[${option.valueName}]]

                                        <!-- âœ… ì¶”ê°€ ê¸ˆì•¡ í‘œì‹œ -->
                                        <th:block th:if="${iterStat.index > 0}">
                                            <th:block th:if="${optionItemMap != null and optionItemMap.containsKey(option.optionValueNo)}">
                                                <th:block th:with="matchedItems=${optionItemMap[option.optionValueNo]}">
                                                    <th:block th:if="${matchedItems != null and not #lists.isEmpty(matchedItems)}">
                                                        <th:block th:with="firstItem=${matchedItems[0]}">
                                                            <th:block th:if="${firstItem.addPrice > 0}">
                                                    <span class="extra-price">
                                                        (+[[${#numbers.formatInteger(firstItem.addPrice, 3, 'COMMA')}]]ì›)
                                                    </span>
                                                            </th:block>
                                                        </th:block>
                                                    </th:block>
                                                </th:block>
                                            </th:block>
                                        </th:block>
                                    </li>
                                </th:block>
                            </th:block>
                        </ul>
                    </div>
                </th:block>
            </div>

            <!-- âœ… ì„ íƒí•œ ì˜µì…˜ì„ ì¶œë ¥í•  ì˜ì—­ -->
            <div id="selected-options"></div>

            <!-- âœ… ì´ ìƒí’ˆ ê¸ˆì•¡ì„ í‘œì‹œí•  ì˜ì—­ -->
            <div id="total-price-container"></div>

            <!-- âœ… ì˜µì…˜ ì¤‘ë³µ ëª¨ë‹¬ -->
            <div id="duplicate-option-modal" class="modal">
                <div class="modal-content">
                    <span class="close-modal">&times;</span>
                    <p>ì´ë¯¸ ì„ íƒëœ ì˜µì…˜ì…ë‹ˆë‹¤.</p>
                    <button id="modal-confirm">í™•ì¸</button>
                </div>
            </div>

            <!-- êµ¬ë§¤ ë²„íŠ¼ -->
            <div class="purchase-buttons">
                <button class="cart-button">ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°</button>
                <button class="buy-now-button">ë°”ë¡œ êµ¬ë§¤í•˜ê¸°</button>
            </div>
        </div>
    </div>
</div>
<script type="module" th:src="@{/js/product/detail.js}"></script>
<!-- ì „ì²´ HOT PICKS ì»¨í…Œì´ë„ˆ -->
<div class="hot-picks-container">
    <!-- HOT PICKS ì„¹ì…˜ -->
    <div class="hot-picks-header" th:attr="data-category-no=${categoryNo}">
        <h2>
            <span id="category-name" th:text="${categoryName}"></span>
            <span class="hot-picks-title-highlight">HOT PICKS</span>
        </h2>
    </div>

    <!-- HOT PICKS íƒ­ -->
    <div class="hot-picks-tabs">
        <button class="hot-picks-tab active" data-period="REALTIME">ì‹¤ì‹œê°„</button>
        <button class="hot-picks-tab" data-period="DAILY">ì¼ê°„</button>
        <button class="hot-picks-tab" data-period="WEEKLY">ì£¼ê°„</button>
        <button class="hot-picks-tab" data-period="MONTHLY">ì›”ê°„</button>
    </div>

    <script>
        // í•„í„° ë²„íŠ¼ í´ë¦­ ì‹œ active í´ë˜ìŠ¤ ë³€ê²½
        document.querySelectorAll('.hot-picks-tab').forEach(button => {
            button.addEventListener('click', function () {
                document.querySelectorAll('.hot-picks-tab').forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
            });
        });
    </script>

    <!-- ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ -->
    <div class="product-list" id="product-list">
        <div th:each="product, iterStat : ${products}" class="product-card" th:attr="data-product-id=${product.no}">

            <!-- ìˆœìœ„ í‘œì‹œ -->
            <div class="rank-badge" th:text="${iterStat.index + 1}"></div>

            <!-- ìƒí’ˆ ì´ë¯¸ì§€ -->
            <img th:src="${product.thumbNailImgUrl}" alt="ìƒí’ˆ ì´ë¯¸ì§€" />

            <div class="product-info">
                <h3 class="product-name" th:text="${product.name}">ìƒí’ˆ ì´ë¦„</h3>
                <div class="price-discount">
                    <span class="discount-rate" th:if="${product.discRate > 0}" th:text="${product.discRate + '%'}"></span>
                    <span class="price" th:text="${#numbers.formatInteger(product.sellPrice, 3, 'COMMA')}"></span>
                </div>
                <div class="product-badges">
                    <span class="badge" th:if="${product.freeShip == 'Y'}">ë¬´ë£Œë°°ì†¡</span>
                    <span class="badge" th:if="${product.handMadeYn == 'Y'}">í•¸ë“œë©”ì´ë“œ</span>
                </div>
            </div>
        </div>
    </div>


    <!-- í˜ì´ì§€ë„¤ì´ì…˜ (ë””ìì¸ ë³€ê²½) -->
    <div class="pagination">
        <button id="prev-page" class="pagination-arrow">&lt;</button>
        <span id="current-page" class="pagination-number">1</span>
        <span class="pagination-separator">/</span>
        <span id="total-pages" class="pagination-total">10</span>
        <button id="next-page" class="pagination-arrow">&gt;</button>
    </div>
</div> <!-- hot-picks-container ì¢…ë£Œ -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const productList = document.getElementById("product-list");
        const filterButtons = document.querySelectorAll(".hot-picks-tab");
        const categoryNo = document.querySelector(".hot-picks-header").getAttribute("data-category-no");

        let currentPage = 1;
        const itemsPerPage = 5;
        let products = [];

        // âœ… ì²« ë Œë”ë§ ì‹œ ê¸°ì¡´ Thymeleaf ë°ì´í„°ë¥¼ í™œìš©í•˜ì—¬ 5ê°œì”© í‘œì‹œ
        const initialProducts = Array.from(document.querySelectorAll(".product-card"));
        products = initialProducts.map(product => ({
            no: product.getAttribute("data-product-id"),
            name: product.querySelector(".product-name").innerText,
            thumbNailImgUrl: product.querySelector("img").src,
            discRate: product.querySelector(".discount-rate") ? product.querySelector(".discount-rate").innerText.replace('%', '') : 0,
            sellPrice: product.querySelector(".price").innerText.replace(',', ''),
            freeShip: product.querySelector(".badge")?.innerText.includes("ë¬´ë£Œë°°ì†¡") ? "Y" : "N",
            handMadeYn: product.querySelector(".badge")?.innerText.includes("í•¸ë“œë©”ì´ë“œ") ? "Y" : "N",
        }));

        function showPage(page) {
            productList.style.transition = "transform 0.5s ease-in-out"; // ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
            productList.style.transform = "translateX(-10px)"; // ì™¼ìª½ìœ¼ë¡œ ì‚´ì§ ì´ë™ í›„
            productList.style.visibility = "hidden"; // ğŸ’¡ ì¼ì‹œì ì¸ 50ê°œ ë…¸ì¶œ ë°©ì§€

            setTimeout(() => {
                productList.innerHTML = ""; // ê¸°ì¡´ ìƒí’ˆ ëª©ë¡ ì´ˆê¸°í™”
                const startIdx = (page - 1) * itemsPerPage;
                const endIdx = startIdx + itemsPerPage;
                const visibleProducts = products.slice(startIdx, endIdx);

                visibleProducts.forEach((product, index) => {
                    const productCard = document.createElement("div");
                    productCard.classList.add("product-card");
                    productCard.setAttribute("data-product-id", product.no);

                    productCard.innerHTML = `
                    <div class="rank-badge">${startIdx + index + 1}</div>
                    <img src="${product.thumbNailImgUrl}" alt="ìƒí’ˆ ì´ë¯¸ì§€" />
                    <div class="product-info">
                        <h3 class="product-name">${product.name}</h3>
                        <div class="price-discount">
                            ${product.discRate > 0 ? `<span class="discount-rate">${product.discRate}%</span>` : ""}
                            <span class="price">${Number(product.sellPrice).toLocaleString()}</span>
                        </div>
                        <div class="product-badges">
                            ${product.freeShip === "Y" ? `<span class="badge">ë¬´ë£Œë°°ì†¡</span>` : ""}
                            ${product.handMadeYn === "Y" ? `<span class="badge">í•¸ë“œë©”ì´ë“œ</span>` : ""}
                        </div>
                    </div>
                `;

                    productList.appendChild(productCard);
                });

                productList.style.transform = "translateX(0)"; // ë‹¤ì‹œ ì›ë˜ ìœ„ì¹˜ë¡œ
                productList.style.visibility = "visible"; // ğŸ’¡ ìµœì¢…ì ìœ¼ë¡œ ë³´ì´ê²Œ ì²˜ë¦¬

                document.getElementById("current-page").innerText = page;
                document.getElementById("total-pages").innerText = Math.ceil(products.length / itemsPerPage);
            }, 100);
        }

        // âœ… ì²« ë Œë”ë§ ì‹œ 5ê°œì”© í‘œì‹œ
        showPage(currentPage);

        // âœ… í˜ì´ì§€ë„¤ì´ì…˜ ê¸°ëŠ¥
        document.getElementById("prev-page").addEventListener("click", function () {
            if (currentPage > 1) {
                currentPage--;
                showPage(currentPage);
            }
        });

        document.getElementById("next-page").addEventListener("click", function () {
            if (currentPage < Math.ceil(products.length / itemsPerPage)) {
                currentPage++;
                showPage(currentPage);
            }
        });

        // âœ… ìƒí’ˆ ì¹´ë“œ í´ë¦­ ì‹œ ìƒì„¸ í˜ì´ì§€ ì´ë™
        productList.addEventListener("click", function (event) {
            const productCard = event.target.closest(".product-card");
            if (productCard) {
                const productId = productCard.getAttribute("data-product-id");
                if (productId) {
                    window.location.href = `/product/detail/${productId}`;
                }
            }
        });

        // âœ… ë¹„ë™ê¸° ìš”ì²­ í›„ ì²˜ë¦¬
        function fetchProducts(period) {
            productList.style.visibility = "hidden"; // ğŸ’¡ ë¹„ë™ê¸° ìš”ì²­ ì¤‘ ë¦¬ìŠ¤íŠ¸ë¥¼ ìˆ¨ê¹€
            productList.style.minHeight = productList.offsetHeight + "px"; // ğŸ’¡ ë ˆì´ì•„ì›ƒ ìœ ì§€

            fetch(`/categories/${categoryNo}/top-views/${period}`)
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200 && data.data && data.data.content) {
                        products = data.data.content.map((product, index) => ({
                            no: product.no,
                            name: product.name,
                            thumbNailImgUrl: product.thumbNailImgUrl,
                            discRate: product.discRate,
                            sellPrice: product.sellPrice,
                            freeShip: product.freeShip,
                            handMadeYn: product.handMadeYn,
                        }));

                        currentPage = 1;
                        showPage(currentPage);
                    } else {
                        console.error("Failed to fetch products:", data);
                    }
                })
                .catch(error => console.error("Error fetching products:", error))
                .finally(() => {
                    productList.style.visibility = "visible"; // ğŸ’¡ ë°ì´í„° ë¡œë”© í›„ ë‹¤ì‹œ ë³´ì´ê²Œ ì„¤ì •
                    productList.style.minHeight = ""; // ğŸ’¡ ë†’ì´ ì´ˆê¸°í™”
                });
        }

        // âœ… í•„í„° ë²„íŠ¼ í´ë¦­ ì‹œ ë¹„ë™ê¸° ìš”ì²­ ì‹¤í–‰
        filterButtons.forEach(button => {
            button.addEventListener("click", function () {
                filterButtons.forEach(btn => btn.classList.remove("active"));
                this.classList.add("active");

                const period = this.getAttribute("data-period");
                fetchProducts(period);
            });
        });
    });
</script>
<!-- ìƒí’ˆ ìƒì„¸ ì •ë³´ ì„¹ì…˜ -->
<div class="product-details-section" id="product-details">
    <h2 class="details-title">ìƒí’ˆì •ë³´</h2>

    <!-- âœ… ë‚´ìš© ë°•ìŠ¤ (ê°€ìš´ë° ì •ë ¬) -->
    <div class="details-content-wrapper" id="details-wrapper">
        <!-- ìƒí’ˆ ì„¤ëª… -->
        <div th:if="${product.desc != null and not #strings.isEmpty(product.desc)}" class="details-box">
            <h3 class="details-heading">ìƒí’ˆ ì„¤ëª…</h3>
            <p th:text="${product.desc}"></p>
        </div>

        <!-- ìƒí’ˆ ìœ ì˜ì‚¬í•­ -->
        <div th:if="${product.cauProd != null and not #strings.isEmpty(product.cauProd)}" class="details-box">
            <h3 class="details-heading">ìƒí’ˆ ìœ ì˜ì‚¬í•­</h3>
            <p th:text="${product.cauProd}"></p>
        </div>

        <!-- ì£¼ë¬¸ ìœ ì˜ì‚¬í•­ -->
        <div th:if="${product.cauOrd != null and not #strings.isEmpty(product.cauOrd)}" class="details-box">
            <h3 class="details-heading">ì£¼ë¬¸ ìœ ì˜ì‚¬í•­</h3>
            <p th:text="${product.cauOrd}"></p>
        </div>

        <!-- ë°°ì†¡ ìœ ì˜ì‚¬í•­ -->
        <div th:if="${product.cauShip != null and not #strings.isEmpty(product.cauShip)}" class="details-box">
            <h3 class="details-heading">ë°°ì†¡ ìœ ì˜ì‚¬í•­</h3>
            <p th:text="${product.cauShip}"></p>
        </div>

        <!-- âœ… ìƒí’ˆ ìƒì„¸ ì´ë¯¸ì§€ ì˜ì—­ -->
        <div class="details-images-wrapper" id="details-images-wrapper">
            <th:block th:each="img : ${product.productImgs}">
                <th:block th:if="${img.repImgYn == 'N'}">
                    <div class="details-image-box">
                        <img th:src="${img.imgUrl}" alt="ìƒì„¸ ì´ë¯¸ì§€" class="details-image">
                    </div>
                </th:block>
            </th:block>
        </div>
    </div>

    <!-- âœ… ë”ë³´ê¸° ë²„íŠ¼ (ê°€ìš´ë° ì •ë ¬) -->
    <button class="details-toggle-btn" id="details-toggle-btn" onclick="toggleDetails()" style="display: none;">
        ìƒí’ˆì„¤ëª… ë”ë³´ê¸° <span class="chevron">&or;</span>
    </button>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const detailsWrapper = document.getElementById("details-wrapper");
        const detailsImagesWrapper = document.getElementById("details-images-wrapper");
        const toggleBtn = document.getElementById("details-toggle-btn");

        let isExpanded = false; // í™•ì¥ ìƒíƒœ ê´€ë¦¬

        function setInitialHeight() {
            const visibleTextHeight = detailsWrapper.offsetHeight - detailsImagesWrapper.offsetHeight;
            const imageElements = document.querySelectorAll(".details-image");
            if (imageElements.length === 0) return;

            const imageHeight = imageElements[0].offsetHeight || 0;
            const visibleHeight = visibleTextHeight + (imageHeight * 2.5); // ì´ë¯¸ì§€ 2.5ê°œ ë³´ì´ë„ë¡ ì¡°ì •

            detailsWrapper.style.maxHeight = visibleHeight + "px";
            detailsWrapper.style.overflow = "hidden"; // ì´ˆê³¼ ë‚´ìš© ê°ì¶”ê¸°

            // âœ… ë†’ì´ê°€ ì„¤ì •ëœ visibleHeightë³´ë‹¤ í¬ë©´ "ë”ë³´ê¸°" ë²„íŠ¼ í‘œì‹œ
            if (detailsImagesWrapper.scrollHeight > visibleHeight) {
                toggleBtn.style.display = "block";
            }
        }

        function toggleDetails() {
            if (!isExpanded) {
                detailsWrapper.style.maxHeight = detailsWrapper.scrollHeight + "px"; // ì „ì²´ ë‚´ìš© ë³´ì´ê¸°
                detailsWrapper.style.overflow = "visible";
                toggleBtn.innerHTML = 'ìƒí’ˆì„¤ëª… ë‹«ê¸° <span class="chevron">&and;</span>';
            } else {
                setInitialHeight(); // ë‹¤ì‹œ ì¶•ì†Œ
                toggleBtn.innerHTML = 'ìƒí’ˆì„¤ëª… ë”ë³´ê¸° <span class="chevron">&or;</span>';
            }
            isExpanded = !isExpanded;
        }

        setTimeout(setInitialHeight, 200); // DOM ë Œë”ë§ í›„ ì‹¤í–‰
        window.toggleDetails = toggleDetails; // ì „ì—­ìœ¼ë¡œ í•¨ìˆ˜ ë“±ë¡
    });
</script>

<!-- í‘¸í„° í¬í•¨ -->
<div th:replace="fragments/footer :: footer-container"></div>
</body>
</html>
